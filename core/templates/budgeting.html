{% extends "base.html" %}
{% load extra_filters %}

{% block content %}

<style>
  .gradient-card {
    background: linear-gradient(145deg, rgba(120,180,255,0.9), rgba(70,130,255,0.8));
    border-radius: 16px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    color: white;
  }
  .gradient-btn {
    background: linear-gradient(145deg, #00ffc3, #00bfa5);
    border: none;
    color: white;
    font-weight: bold;
  }
  .gradient-btn:hover {
    background: linear-gradient(145deg, #00e6b0, #00a88f);
  }
  .notification {
    background-color: #ffc107;
    color: #212529;
    border-radius: 10px;
    padding: 15px 20px;
    margin-bottom: 25px;
    font-weight: 600;
  }
  .budget-table th, .budget-table td {
    vertical-align: middle !important;
  }
  .form-inline {
    max-width: 700px;
    margin: auto;
  }

  /* Responsive adjustments */
  @media (max-width: 767.98px) {
    .form-inline {
      max-width: 100%;
      padding: 0 1rem;
      gap: 0.5rem !important;
      justify-content: center !important;
    }
    .form-inline > div.col-auto {
      flex: 1 1 100%;
      max-width: 100%;
    }
    .budget-table {
      font-size: 0.9rem;
    }
    .budget-table th, .budget-table td {
      padding: 0.4rem 0.6rem !important;
    }
    .budget-table thead {
      font-size: 1rem;
    }
    h2 {
      font-size: 1.5rem;
    }
  }
</style>

<div class="container my-5">
  <h2 class="mb-4 text-center text-white">Monthly Budgeting</h2>


  <!-- Add/Update Budget Form -->
  <form method="post" class="mb-5 form-inline d-flex gap-3 justify-content-center align-items-end flex-wrap">
    {% csrf_token %}

    <div class="col-auto">
      <label for="month" class="form-label text-white fw-semibold">Select Month</label>
      <select name="month" id="month" class="form-select" required>
        {% for num, name in months_list %}
          <option value="{{ num }}" {% if num == selected_month %}selected{% endif %}>{{ name }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="col-auto">
      <label for="year" class="form-label text-white fw-semibold">Select Year</label>
      <select name="year" id="year" class="form-select" required>
        {% for y in years_list %}
          <option value="{{ y }}" {% if y == selected_year %}selected{% endif %}>{{ y }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="col-auto">
      <label for="category" class="form-label text-white fw-semibold">Select Category</label>
      <select name="category_id" id="category" class="form-select" required>
        <option value="" disabled selected>Select Category</option>
        {% for cat in categories %}
          <option value="{{ cat.id }}">{{ cat.name }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="col-auto">
      <label for="budget_amount" class="form-label text-white fw-semibold">Set Budget (₹)</label>
      <input type="number" min="0" step="0.01" id="budget_amount" name="budget_amount" class="form-control" placeholder="Enter amount" required>
    </div>

    <div class="col-auto">
      <button type="submit" class="btn gradient-btn px-4">Add / Update Budget</button>
    </div>
  </form>

  <!-- Existing Budgets Table -->
  <div class="table-responsive">
    <table class="table table-dark table-striped text-white text-center align-middle budget-table shadow rounded mx-auto" style="max-width: 750px;">
      <thead class="table-primary text-dark">
        <tr>
          <th>Category</th>
          <th>Budget (₹)</th>
          <th>Expenses (₹)</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for cat in categories %}
          <tr>
            <td class="fw-semibold">{{ cat.name }}</td>
            <td>{{ budget_dict|dict_get:cat.id|default:"0.00" }}</td>
            <td>{{ expenses_dict|dict_get:cat.id|default:"0.00" }}</td>
            <td>
              {% if cat.id in budget_dict %}
                <form method="post" action="{% url 'delete_budget' cat.id %}" onsubmit="return confirm('Are you sure you want to delete the budget for {{ cat.name }}?');" style="display:inline;">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-sm btn-danger">
                    <i class="fas fa-trash"></i> Delete
                  </button>
                </form>
              {% else %}
                <span class="text-secondary">No Budget</span>
              {% endif %}
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="4">No categories found.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% endblock %}
